<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snake Game</title>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    canvas {
      border: 2px solid #fff;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>
  <script>
    const config = {
      type: Phaser.AUTO,
      width: 400,
      height: 400,
      backgroundColor: '#222',
      scene: {
        preload,
        create,
        update
      }
    };

    const game = new Phaser.Game(config);
    let snake;
    let food;
    let cursors;
    let snakeLength = 3;
    let direction = 'RIGHT';
    let lastDirection = 'RIGHT';
    let snakeBody = [];
    let gameOver = false;
    let score = 0;
    let scoreText;

    function preload() {}

    function create() {
      // Texto de puntaje
      scoreText = this.add.text(10, 10, `Puntaje: ${score}`, { fontSize: '16px', fill: '#fff' });

      // Crear la serpiente inicial
      snake = this.add.rectangle(200, 200, 10, 10, 0x00ff00);
      snakeBody.push(snake);

      // Generar la comida
      food = createFood(this);

      // Controles
      cursors = this.input.keyboard.createCursorKeys();
    }

    function update() {
      if (gameOver) {
        return;
      }

      // Actualizar dirección
      if (cursors.left.isDown && lastDirection !== 'RIGHT') {
        direction = 'LEFT';
      } else if (cursors.right.isDown && lastDirection !== 'LEFT') {
        direction = 'RIGHT';
      } else if (cursors.up.isDown && lastDirection !== 'DOWN') {
        direction = 'UP';
      } else if (cursors.down.isDown && lastDirection !== 'UP') {
        direction = 'DOWN';
      }

      // Mover la serpiente
      moveSnake(this);

      // Verificar colisiones con la pared o consigo misma
      checkCollisions(this);

      // Verificar si la serpiente ha comido la comida
      if (Phaser.Geom.Intersects.RectangleToRectangle(snake, food)) {
        eatFood(this);
      }

      // Actualizar el puntaje
      scoreText.setText(`Puntaje: ${score}`);
    }

    function moveSnake(scene) {
      lastDirection = direction;

      // Mover la cabeza
      if (direction === 'LEFT') snake.x -= 10;
      if (direction === 'RIGHT') snake.x += 10;
      if (direction === 'UP') snake.y -= 10;
      if (direction === 'DOWN') snake.y += 10;

      // Mover el cuerpo de la serpiente
      for (let i = snakeBody.length - 1; i > 0; i--) {
        snakeBody[i].x = snakeBody[i - 1].x;
        snakeBody[i].y = snakeBody[i - 1].y;
      }

      // Colocar la cabeza en el inicio del arreglo
      snakeBody[0] = snake;

      // Dibujar la serpiente
      for (let i = 0; i < snakeBody.length; i++) {
        scene.add.rectangle(snakeBody[i].x, snakeBody[i].y, 10, 10, 0x00ff00);
      }
    }

    function createFood(scene) {
      const foodX = Phaser.Math.Between(0, 39) * 10;
      const foodY = Phaser.Math.Between(0, 39) * 10;
      return scene.add.rectangle(foodX, foodY, 10, 10, 0xff0000);
    }

    function eatFood(scene) {
      // Aumentar el tamaño de la serpiente
      snakeLength++;
      score += 10;

      // Crear una nueva comida
      food.destroy();
      food = createFood(scene);
    }

    function checkCollisions(scene) {
      // Chocar con las paredes
      if (snake.x < 0 || snake.x >= 400 || snake.y < 0 || snake.y >= 400) {
        gameOver = true;
        endGame(scene);
      }

      // Chocar consigo misma
      for (let i = 1; i < snakeBody.length; i++) {
        if (snake.x === snakeBody[i].x && snake.y === snakeBody[i].y) {
          gameOver = true;
          endGame(scene);
        }
      }
    }

    function endGame(scene) {
      scene.add.text(150, 200, '¡Game Over!', { fontSize: '32px', fill: '#fff' });
      scene.add.text(140, 240, `Puntaje final: ${score}`, { fontSize: '16px', fill: '#fff' });
      scene.add.text(140, 270, 'Presiona R para reiniciar', { fontSize: '16px', fill: '#fff' });

      // Reiniciar el juego al presionar "R"
      scene.input.keyboard.once('keydown-R', () => {
        gameOver = false;
        score = 0;
        snake.x = 200;
        snake.y = 200;
        snakeLength = 3;
        snakeBody = [snake];
        direction = 'RIGHT';
        lastDirection = 'RIGHT';
        scoreText.setText(`Puntaje: ${score}`);
        scene.scene.restart();
      });
    }
  </script>
</body>
</html>
